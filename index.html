<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="src/img/favicon.png" />
  <title>SWMTS | @BN_LOS</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Fira+Code:wght@300;400;500;600;700&display=swap');
    
    :root {
      /* Color Palette */
      --primary-dark: #0a0a0f;
      --secondary-dark: #0f0f17;
      --tertiary-dark: #1a1a24;
      --accent-purple: #6366f1;
      --accent-cyan: #06b6d4;
      --accent-pink: #ec4899;
      --accent-orange: #f59e0b;
      --accent-green: #10b981;
      
      /* Glassmorphism */
      --glass-bg: rgba(26, 26, 36, 0.4);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
      
      /* Text Colors */
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      
      /* Gradients */
      --gradient-primary: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
      --gradient-secondary: linear-gradient(135deg, var(--accent-pink), var(--accent-orange));
      --gradient-tertiary: linear-gradient(135deg, var(--accent-cyan), var(--accent-green));
      --gradient-bg: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 50%, var(--tertiary-dark) 100%);
      
      /* Animation Timing */
      --animation-fast: 0.2s;
      --animation-normal: 0.3s;
      --animation-slow: 0.5s;
      --animation-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
      --animation-smooth: cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--gradient-bg);
      color: var(--text-primary);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      font-weight: 400;
      line-height: 1.6;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
      z-index: -2;
    }
    
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="%23ffffff" opacity="0.02"/><circle cx="75" cy="75" r="1" fill="%23ffffff" opacity="0.02"/><circle cx="50" cy="10" r="1" fill="%23ffffff" opacity="0.015"/><circle cx="10" cy="50" r="1" fill="%23ffffff" opacity="0.015"/><circle cx="90" cy="30" r="1" fill="%23ffffff" opacity="0.015"/></pattern></defs><rect width="100%" height="100%" fill="url(%23grain)"/></svg>') repeat;
      pointer-events: none;
      z-index: -1;
    }
    
    @keyframes float {
      0%, 100% { transform: translate(0px, 0px) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(120deg); }
      66% { transform: translate(-20px, 20px) rotate(240deg); }
    }
    #app-content {
      margin: 0 auto;
      padding: 2rem;
      position: relative;
      z-index: 1;
    }
    .hidden {
      display: none !important;
    }
    
    /* Utility Classes */
    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
    }
    
    .glow {
      position: relative;
    }
    
    .glow::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: var(--gradient-primary);
      border-radius: inherit;
      opacity: 0;
      z-index: -1;
      transition: opacity var(--animation-normal) var(--animation-smooth);
    }
    
    .glow:hover::before {
      opacity: 0.7;
    }
    
    .animate-fade-in {
      animation: fadeInUp 0.8s var(--animation-smooth) forwards;
    }
    
    .animate-slide-up {
      animation: slideUp 0.6s var(--animation-smooth) forwards;
    }
    
    .animate-bounce-in {
      animation: bounceIn 0.8s var(--animation-bounce) forwards;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(50px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: scale(0.3) translateY(50px);
      }
      50% {
        opacity: 1;
        transform: scale(1.05) translateY(-10px);
      }
      70% {
        transform: scale(0.95) translateY(5px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    .hero {
      text-align: center;
      padding: 4rem 2rem;
      position: relative;
      z-index: 2;
    }
    
    .hero-content {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .hero h1 {
      font-size: clamp(2.5rem, 8vw, 5rem);
      font-weight: 900;
      margin-bottom: 1.5rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 40px rgba(99, 102, 241, 0.3);
      position: relative;
      animation: heroGlow 3s ease-in-out infinite alternate;
    }
    
    .hero h1::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
      z-index: -1;
      animation: pulse 4s ease-in-out infinite;
    }
    
    .hero-subtitle {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      font-weight: 500;
      opacity: 0;
      animation: fadeInUp 1s ease-out 0.5s forwards;
    }
    
    .hero-cta {
      opacity: 0;
      animation: fadeInUp 1s ease-out 1s forwards;
    }
    
    @keyframes heroGlow {
      0% {
        filter: brightness(1) saturate(1);
      }
      100% {
        filter: brightness(1.2) saturate(1.3);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 0.3;
        transform: translate(-50%, -50%) scale(1);
      }
      50% {
        opacity: 0.6;
        transform: translate(-50%, -50%) scale(1.1);
      }
    }
    .search-container {
      position: relative;
      margin: 0 auto 3rem;
      max-width: 600px;
      opacity: 0;
      animation: slideUp 0.8s ease-out 0.3s forwards;
    }
    
    .search-wrapper {
      position: relative;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: 2rem;
      overflow: hidden;
      transition: all var(--animation-normal) var(--animation-smooth);
    }
    
    .search-wrapper:focus-within {
      border-color: var(--accent-purple);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1), var(--glass-shadow);
      transform: translateY(-2px);
    }
    
    .search-input {
      width: 100%;
      padding: 1.25rem 4rem 1.25rem 2rem;
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-size: 1.1rem;
      font-weight: 500;
      outline: none;
      font-family: inherit;
    }
    
    .search-input::placeholder {
      color: var(--text-muted);
      font-weight: 400;
    }
    
    .search-icon {
      position: absolute;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 1.25rem;
      transition: all var(--animation-normal) var(--animation-smooth);
      pointer-events: none;
    }
    
    .search-wrapper:focus-within .search-icon {
      color: var(--accent-purple);
      transform: translateY(-50%) scale(1.1);
    }
    
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: 1rem;
      margin-top: 0.5rem;
      max-height: 300px;
      overflow-y: auto;
      z-index: 1000;
      opacity: 0;
      transform: translateY(-10px);
      transition: all var(--animation-normal) var(--animation-smooth);
      pointer-events: none;
    }
    
    .search-suggestions.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }
    .tabs-section {
      margin: 3rem 0;
      opacity: 0;
      animation: fadeInUp 0.8s ease-out 0.7s forwards;
    }
    
    .tabs-container {
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    
    .tab-item {
      position: relative;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      padding: 1rem 2rem;
      cursor: pointer;
      border-radius: 2rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-secondary);
      transition: all var(--animation-normal) var(--animation-smooth);
      overflow: hidden;
    }
    
    .tab-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: var(--gradient-primary);
      transition: left var(--animation-slow) var(--animation-smooth);
      z-index: -1;
    }
    
    .tab-item:hover {
      color: var(--text-primary);
      border-color: var(--accent-purple);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);
    }
    
    .tab-item:hover::before {
      left: 0;
    }
    
    .tab-item.active {
      color: var(--text-primary);
      background: var(--gradient-primary);
      border-color: var(--accent-purple);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
      transform: translateY(-3px);
    }
    
    .tab-item.active::before {
      left: 0;
    }
    .dropdown-container {
      display: none;
      justify-content: center;
      margin: 1.5rem 0;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
    }
    
    .dropdown-container.show {
      display: flex;
    }
    
    .dropdown-container select {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--text-primary);
      border: 1px solid var(--glass-border);
      border-radius: 1.5rem;
      padding: 1rem 3rem 1rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M3 4.5L6 7.5L9 4.5' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 12px;
      transition: all var(--animation-normal) var(--animation-smooth);
      min-width: 200px;
    }
    
    .dropdown-container select:hover {
      border-color: var(--accent-purple);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
    }
    
    .dropdown-container select:focus {
      outline: none;
      border-color: var(--accent-purple);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }

    .section-divider {
      position: relative;
      text-align: center;
      margin: 4rem 0 3rem;
      opacity: 0;
      animation: fadeInUp 0.8s ease-out 1s forwards;
    }
    
    .section-divider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent-purple), var(--accent-cyan), transparent);
      transform: translateY(-50%);
      z-index: -1;
    }
    
    .section-divider span {
      background: var(--primary-dark);
      padding: 0 2rem;
      color: var(--text-primary);
      font-weight: 700;
      font-size: 1.5rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
    }
    
    .section-divider span::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--gradient-primary);
      border-radius: 2px;
    }
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 2rem;
      padding: 2rem 0;
      opacity: 0;
      animation: fadeInUp 1s ease-out 1.2s forwards;
    }
    
    @media (max-width: 1400px) {
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1.5rem;
      }
    }
    
    @media (max-width: 768px) {
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem;
        padding: 1rem 0;
      }
    }
    
    @media (max-width: 480px) {
      .cards-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }
    }
    .custom-card {
      position: relative;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: 1.5rem;
      overflow: hidden;
      box-shadow: var(--glass-shadow);
      transition: all var(--animation-slow) var(--animation-smooth);
      display: flex;
      flex-direction: column;
      cursor: pointer;
      opacity: 0;
      transform: translateY(50px) scale(0.9);
      animation: cardReveal 0.8s ease-out forwards;
    }
    
    .custom-card:nth-child(1) { animation-delay: 0.1s; }
    .custom-card:nth-child(2) { animation-delay: 0.2s; }
    .custom-card:nth-child(3) { animation-delay: 0.3s; }
    .custom-card:nth-child(4) { animation-delay: 0.4s; }
    .custom-card:nth-child(5) { animation-delay: 0.5s; }
    .custom-card:nth-child(6) { animation-delay: 0.6s; }
    .custom-card:nth-child(n+7) { animation-delay: 0.7s; }
    
    .custom-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--gradient-primary);
      opacity: 0;
      transition: opacity var(--animation-normal) var(--animation-smooth);
      z-index: -1;
      border-radius: inherit;
    }
    
    .custom-card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2), var(--glass-shadow);
      border-color: var(--accent-purple);
    }
    
    .custom-card:hover::before {
      opacity: 0.1;
    }
    
    @keyframes cardReveal {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .card-image-container {
      position: relative;
      overflow: hidden;
      border-radius: 1rem 1rem 0 0;
    }
    
    .card-image-container img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      transition: transform var(--animation-slow) var(--animation-smooth);
      display: block;
    }
    
    .custom-card:hover img {
      transform: scale(1.15) rotate(2deg);
    }
    
    .card-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
      opacity: 0;
      transition: opacity var(--animation-normal) var(--animation-smooth);
      border-radius: inherit;
    }
    
    .custom-card:hover .card-overlay {
      opacity: 1;
    }
    
    .card-image-container::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100px;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
      opacity: 0;
      transition: opacity var(--animation-normal) var(--animation-smooth);
    }
    
    .custom-card:hover .card-image-container::after {
      opacity: 1;
    }
    
    .card-content {
      padding: 1.5rem;
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 2;
    }
    
    .card-content h3 {
      margin: 0 0 0.75rem 0;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.3;
      transition: color var(--animation-normal) var(--animation-smooth);
    }
    
    .custom-card:hover .card-content h3 {
      color: var(--accent-purple);
    }
    
    .card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      gap: 0.5rem;
    }
    
    .badge {
      font-size: 0.7rem;
      padding: 0.3rem 0.8rem;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 1rem;
      color: var(--text-secondary);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all var(--animation-normal) var(--animation-smooth);
    }
    
    .badge:hover {
      background: var(--accent-purple);
      color: var(--text-primary);
      transform: translateY(-1px);
    }
    
    .card-desc {
      flex: 1;
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 1.5rem;
      line-height: 1.6;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      transition: color var(--animation-normal) var(--animation-smooth);
    }
    
    .custom-card:hover .card-desc {
      color: var(--text-secondary);
    }
    
    .card-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: auto;
    }
    
    .card-actions .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.8rem 1.5rem;
      border-radius: 1.5rem;
      font-weight: 600;
      font-size: 0.85rem;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--animation-normal) var(--animation-smooth);
      position: relative;
      overflow: hidden;
    }
    
    .card-actions .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: var(--gradient-primary);
      transition: left var(--animation-normal) var(--animation-smooth);
      z-index: -1;
    }
    
    .card-actions .btn:hover {
      color: var(--text-primary);
      border-color: var(--accent-purple);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.2);
    }
    
    .card-actions .btn:hover::before {
      left: 0;
    }
    
    .card-actions .btn:active {
      transform: translateY(0) scale(0.98);
    }
    
    .btn-watched-toggle.is-watched {
      background: var(--gradient-secondary);
      color: var(--text-primary);
      border-color: var(--accent-pink);
      box-shadow: 0 5px 15px rgba(236, 72, 153, 0.2);
    }
    
    .btn-watched-toggle.is-watched:hover {
      box-shadow: 0 8px 25px rgba(236, 72, 153, 0.3);
      transform: translateY(-3px);
    }
    .header-controls {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .header-controls label {
      margin-right: 8px;
      font-weight: 500;
    }
    .header-controls select,
    .header-controls button {
      background: #1f1f1f;
      color: #f5f5f5;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 5px 45px 5px 10px;
      outline: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg width='10' height='10' viewBox='0 0 10 10' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 3L5 7L9 3' stroke='%23ccc' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"), linear-gradient(to bottom, #1f1f1f, #1f1f1f);
      background-repeat: no-repeat, repeat;
      background-position: right 8px center, 0 0;
      background-size: 12px auto, 100%;
      font-size: 0.9rem;
      cursor: pointer;
      transition: border-color 0.2s, background-color 0.2s;
    }
    .header-controls select:hover,
    .header-controls button:hover {
      border-color: #888;
    }
    .header-controls select:focus,
    .header-controls button:focus {
      border-color: #aaa;
    }
    #loading-indicator {
      text-align: center;
      padding: 40px;
      font-weight: 500;
      font-size: 1rem;
      color: #aaa;
    }
    .spin {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    .error-message {
      background: #d9534f;
      color: #fff;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
    }
    #error-message-container {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 500px;
      z-index: 1050;
    }
    .fade-in {
      animation: fadeIn 0.5s ease;
    }
    .fade-out {
      animation: fadeOut 0.5s forwards;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: scale(0.95);
      }
    }
    .no-results {
      color: #aaa;
      font-size: 1rem;
      margin-top: 30px;
    }
    /* Toast styling */
    .toast-container {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #232323;
      border-radius: 25px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .app-toast {
      background: var(--toast-bg);
      color: #fff;
      border-radius: 8px;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
      opacity: 0;
      transform: translateY(-10px);
      animation: toastIn 0.4s forwards, toastOut 0.4s 3s forwards;
    }
    @keyframes toastIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes toastOut {
      to {
        opacity: 0;
        transform: translateY(-10px);
      }
    }
    @keyframes fadeOutDown {
      to {
        opacity: 0;
        transform: translateY(20px) scale(0.9);
      }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      #app-content {
        padding: 1rem;
      }
      
      .hero {
        padding: 2rem 1rem;
      }
      
      .hero h1 {
        font-size: clamp(2rem, 6vw, 3rem);
      }
      
      .hero-subtitle {
        font-size: 1rem;
      }
      
      .search-container {
        max-width: 100%;
        margin: 0 auto 2rem;
      }
      
      .search-input {
        padding: 1rem 3.5rem 1rem 1.5rem;
        font-size: 1rem;
      }
      
      .tabs-container {
        gap: 0.5rem;
      }
      
      .tab-item {
        padding: 0.8rem 1.5rem;
        font-size: 0.85rem;
      }
      
      .header-controls {
        position: relative;
        top: auto;
        right: auto;
        justify-content: center;
        margin-bottom: 2rem;
      }
      
      .header-controls .control-group {
        flex-direction: column;
        text-align: center;
      }
      
      .toast-container {
        top: 1rem;
        left: 1rem;
        right: 1rem;
        max-width: none;
      }
    }
    
    @media (max-width: 480px) {
      .hero {
        padding: 1.5rem 0.5rem;
      }
      
      .search-input {
        padding: 0.9rem 3rem 0.9rem 1.25rem;
        font-size: 0.95rem;
      }
      
      .tab-item {
        padding: 0.7rem 1.25rem;
        font-size: 0.8rem;
      }
      
      .card-content {
        padding: 1rem;
      }
      
      .card-content h3 {
        font-size: 1rem;
      }
      
      .card-desc {
        font-size: 0.8rem;
      }
      
      .card-actions .btn {
        padding: 0.7rem 1.25rem;
        font-size: 0.8rem;
      }
    }
    
    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* Focus styles for keyboard navigation */
    .tab-item:focus,
    .custom-card:focus,
    .btn:focus {
      outline: 2px solid var(--accent-purple);
      outline-offset: 2px;
    }
    
    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --glass-bg: rgba(0, 0, 0, 0.9);
        --glass-border: rgba(255, 255, 255, 0.3);
        --text-secondary: #ffffff;
        --text-muted: #cccccc;
      }
    }
  </style>
</head>
<body>
  <div id="app-content">
    <div class="header-controls">
      <div class="control-group">
        <label for="sortSelect">Sort:</label>
        <select id="sortSelect">
          <option value="default">Popularity</option>
          <option value="asc">A-Z</option>
          <option value="desc">Z-A</option>
        </select>
      </div>
      <div class="control-group">
        <button id="exportBtn" class="btn">
          <i class="bi bi-download"></i> Export
        </button>
        <button id="importBtn" class="btn">
          <i class="bi bi-upload"></i> Import
        </button>
        <input type="file" id="importFile" accept=".json" class="hidden" />
      </div>
    </div>

    <div class="hero">
      <div class="hero-content">
        <h1 class="animate-fade-in">SWMTS</h1>
        <p class="hero-subtitle">Discover, Watch, Track - Your Ultimate Entertainment Hub</p>
        <div class="hero-cta">
          <span class="hero-scroll-indicator">↓ Explore Content ↓</span>
        </div>
      </div>
    </div>

    <div class="search-container">
      <div class="search-wrapper">
        <input type="text" id="searchInput" class="search-input" placeholder="Search for movies, TV shows, cast..." />
        <i class="bi bi-search search-icon"></i>
      </div>
      <div id="searchSuggestions" class="search-suggestions"></div>
    </div>

    <div class="tabs-section">
      <div class="tabs-container" id="tabsContainer">
        <button role="tab" id="trending-tab" class="tab-item glow" onclick="activateTab(this, 'trending', 'week')">
          <i class="bi bi-fire"></i> Trending
        </button>
        <button role="tab" id="popular-tab" class="tab-item glow" onclick="activateTab(this, 'popular')">
          <i class="bi bi-star"></i> Popular
        </button>
        <button role="tab" id="networks-tab" class="tab-item glow" onclick="activateTab(this, 'network')">
          <i class="bi bi-tv"></i> Networks
        </button>
        <button role="tab" id="watched-tab" class="tab-item glow" onclick="activateTab(this, 'watched')">
          <i class="bi bi-check-circle"></i> Watched
        </button>
      </div>
      <div class="dropdown-container" id="trendingDropdown">
        <select id="trendingSelect">
          <option value="day">Day</option>
          <option value="week" selected>Week</option>
          <option value="year">Year</option>
        </select>
      </div>
      <div class="dropdown-container" id="networksDropdown">
        <select id="networkSelect">
          <option value="213">Netflix</option>
          <option value="2739">Disney+</option>
          <option value="49">HBO</option>
          <option value="1024">Prime Video</option>
          <option value="15">Hulu</option>
          <option value="2552">Apple TV+</option>
        </select>
      </div>
    </div>

    <div class="section-divider">
      <span>SWMTS Collection</span>
    </div>

    <div class="cards-grid" id="swmtscards"></div>
    <div id="loading-indicator" class="loading-indicator hidden">
      <div class="loading-spinner"></div>
      <p>Loading amazing content...</p>
    </div>
  </div>

  <div id="error-message-container">
    <div id="error-message" class="hidden error-message" role="alert"></div>
  </div>
  <div class="toast-container" id="toastContainer"></div>
  <script>
    const TMDB_API_KEY = 'db841157430b89c9ab8833d281d1c060';
    const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
    const swmtscards = document.getElementById('swmtscards');
    const searchInput = document.getElementById('searchInput');
    const loadingIndicator = document.getElementById('loading-indicator');
    const errorMessage = document.getElementById('error-message');
    const sortSelect = document.getElementById('sortSelect');
    const importBtn = document.getElementById('importBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');
    const toastContainer = document.getElementById('toastContainer');
    const trendingDropdown = document.getElementById('trendingDropdown');
    const networksDropdown = document.getElementById('networksDropdown');
    const trendingSelect = document.getElementById('trendingSelect');
    const networkSelect = document.getElementById('networkSelect');

    let data = [];
    let sortMethod = 'default';
    let currentPage = 1;
    let loading = false;
    let currentQuery = '';
    let activeMode = 'trending';
    let activeParam = 'week'; // For trending: day/week/year, for network: networkId
    
    // Enhanced animations and interactions
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };
    
    const cardObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.animationPlayState = 'running';
        }
      });
    }, observerOptions);
    
    // Add smooth scrolling and page load animations
    document.addEventListener('DOMContentLoaded', () => {
      // Trigger initial animations
      document.body.style.opacity = '1';
      
      // Add parallax effect to background
      window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        const parallax = document.querySelector('body::before');
        if (parallax) {
          parallax.style.transform = `translateY(${scrolled * 0.5}px)`;
        }
      });
    });

    function showError(msg) {
      errorMessage.textContent = msg;
      errorMessage.classList.remove('hidden');
      clearTimeout(errorMessage.timeoutId);
      errorMessage.timeoutId = setTimeout(() => {
        errorMessage.classList.add('hidden');
      }, 5000);
    }

    function showToast(message, iconClass = 'bi-check-circle-fill', type = 'success') {
      const toast = document.createElement('div');
      toast.className = 'app-toast';
      
      // Add different styles based on type
      const typeStyles = {
        success: 'var(--accent-green)',
        error: '#ef4444',
        warning: 'var(--accent-orange)',
        info: 'var(--accent-cyan)'
      };
      
      toast.style.borderLeftColor = typeStyles[type];
      toast.innerHTML = `<i class="bi ${iconClass}" style="color: ${typeStyles[type]}"></i> ${message}`;
      
      toastContainer.appendChild(toast);
      
      // Add click to dismiss
      toast.addEventListener('click', () => {
        toast.style.animation = 'toastSlideOut 0.3s ease-in forwards';
        setTimeout(() => toast.remove(), 300);
      });
      
      setTimeout(() => {
        if (toast.parentNode) {
          toast.style.animation = 'toastSlideOut 0.4s ease-in forwards';
          setTimeout(() => toast.remove(), 400);
        }
      }, 4000);
    }

    function getWatchedList() {
      return JSON.parse(localStorage.getItem('watchedList') || '[]');
    }
    function setWatchedList(list) {
      localStorage.setItem('watchedList', JSON.stringify(list));
      deduplicateWatchedList();
    }
    function deduplicateWatchedList() {
      const list = getWatchedList();
      const unique = [];
      const seen = new Set();
      list.forEach(i => {
        if (i && i.id != null && i.type != null) {
          const key = `${i.id}-${i.type}`;
          if (!seen.has(key)) {
            seen.add(key);
            unique.push(i);
          }
        }
      });
      if (unique.length !== list.length) {
        localStorage.setItem('watchedList', JSON.stringify(unique));
      }
    }

    exportBtn.addEventListener('click', () => {
      const list = getWatchedList();
      if (list.length === 0) {
        showToast('Watchlist is empty!', 'bi-exclamation-circle-fill');
        return;
      }
      const blob = new Blob([JSON.stringify(list, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'swmts_watchlist.json';
      a.click();
      URL.revokeObjectURL(url);
      showToast('Watchlist exported ✔️');
    });

    importBtn.addEventListener('click', () => importFile.click());
    importFile.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        try {
          const importedList = JSON.parse(ev.target.result);
          if (!Array.isArray(importedList)) throw new Error('Invalid format');
          setWatchedList(importedList);
          showToast('Watchlist imported ✔️');
          if (activeMode === 'watched') fetchWatchedData();
        } catch {
          showError('Failed to import: Invalid JSON');
        }
      };
      reader.readAsText(file);
      importFile.value = '';
    });

    function activateTab(btn, mode, param = null) {
      // Add ripple effect
      createRipple(btn, event);
      
      document.querySelectorAll('.tab-item').forEach(tab => {
        tab.classList.remove('active');
        tab.style.transform = 'scale(1)';
      });
      
      btn.classList.add('active');
      btn.style.transform = 'scale(1.05)';
      
      currentPage = 1;
      currentQuery = '';
      
      // Animate cards out before loading new content
      const existingCards = document.querySelectorAll('.custom-card');
      existingCards.forEach((card, index) => {
        setTimeout(() => {
          card.classList.add('fade-out');
        }, index * 50);
      });
      
      setTimeout(() => {
        swmtscards.innerHTML = '';
        activeMode = mode;
        activeParam = param;

        // Show/hide dropdowns with animation
        document.querySelectorAll('.dropdown-container').forEach(dropdown => {
          dropdown.classList.remove('show');
          dropdown.style.display = 'none';
        });
        
        if (mode === 'trending') {
          trendingDropdown.style.display = 'flex';
          trendingDropdown.classList.add('show');
          trendingSelect.value = param || 'week';
          fetchTrending(param || 'week', true);
        } else if (mode === 'network') {
          networksDropdown.style.display = 'flex';
          networksDropdown.classList.add('show');
          const networkId = networkSelect.value;
          activeParam = networkId;
          fetchNetworkData(networkId, true);
        } else if (mode === 'popular') {
          fetchData(true);
        } else if (mode === 'watched') {
          fetchWatchedData();
        }
      }, existingCards.length * 50 + 200);
    }
    
    // Create ripple effect for buttons
    function createRipple(element, event) {
      const circle = document.createElement('span');
      const diameter = Math.max(element.clientWidth, element.clientHeight);
      const radius = diameter / 2;
      
      const rect = element.getBoundingClientRect();
      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${event.clientX - rect.left - radius}px`;
      circle.style.top = `${event.clientY - rect.top - radius}px`;
      circle.classList.add('ripple');
      
      const rippleCSS = `
        .ripple {
          position: absolute;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.3);
          transform: scale(0);
          animation: ripple-animation 0.6s linear;
          pointer-events: none;
        }
        @keyframes ripple-animation {
          to {
            transform: scale(4);
            opacity: 0;
          }
        }
      `;
      
      if (!document.querySelector('#ripple-styles')) {
        const style = document.createElement('style');
        style.id = 'ripple-styles';
        style.textContent = rippleCSS;
        document.head.appendChild(style);
      }
      
      const existingRipple = element.querySelector('.ripple');
      if (existingRipple) {
        existingRipple.remove();
      }
      
      element.appendChild(circle);
      
      setTimeout(() => {
        circle.remove();
      }, 600);
    }

    async function fetchData(reset = false) {
      if (loading) return;
      if (reset) {
        data = [];
        swmtscards.innerHTML = '';
      }
      loading = true;
      loadingIndicator.classList.remove('hidden');
      try {
        const [moviesRes, tvRes] = await Promise.all([
          fetch(`${TMDB_BASE_URL}/movie/popular?api_key=${TMDB_API_KEY}&page=${currentPage}`),
          fetch(`${TMDB_BASE_URL}/tv/popular?api_key=${TMDB_API_KEY}&page=${currentPage}`)
        ]);
        if (!moviesRes.ok || !tvRes.ok) throw new Error('Failed to load popular');
        const movies = await moviesRes.json();
        const tvs = await tvRes.json();
        const combined = [...movies.results, ...tvs.results]
          .filter(i => i.poster_path)
          .map(i => ({
            id: i.id,
            title: i.title || i.name,
            desc: i.overview || 'N/A',
            img: `https://image.tmdb.org/t/p/w500${i.poster_path}`,
            date: i.release_date || i.first_air_date,
            type: i.title ? 'movie' : 'tv',
            popularity: i.popularity
          }));
        const keys = new Set(data.map(d => `${d.id}-${d.type}`));
        const unique = combined.filter(i => !keys.has(`${i.id}-${i.type}`));
        data = [...data, ...unique];
        applySortingAndRender(unique);
      } catch (e) {
        showError(e.message);
      } finally {
        loading = false;
        loadingIndicator.classList.add('hidden');
      }
    }

    async function fetchWatchedData() {
      if (loading) return;
      loading = true;
      loadingIndicator.classList.remove('hidden');
      swmtscards.innerHTML = '';
      const list = getWatchedList();
      data = [];
      if (list.length === 0) {
        swmtscards.innerHTML = '<p class="no-results text-center">Watched list empty.</p>';
        loading = false;
        loadingIndicator.classList.add('hidden');
        return;
      }
      try {
        const promises = list.map(item => {
          const ep = item.type === 'movie' ? `/movie/${item.id}` : `/tv/${item.id}`;
          return fetch(`${TMDB_BASE_URL}${ep}?api_key=${TMDB_API_KEY}`)
            .then(r => (r.ok ? r.json() : null))
            .then(d => d && d.poster_path ? {
              id: d.id,
              title: d.title || d.name,
              desc: d.overview || 'N/A',
              img: `https://image.tmdb.org/t/p/w500${d.poster_path}`,
              date: d.release_date || d.first_air_date,
              type: item.type,
              popularity: d.popularity
            } : null)
            .catch(() => null);
        });
        const results = await Promise.all(promises);
        data = results.filter(i => i);
        if (data.length === 0 && list.length > 0) showError("Couldn't load watched.");
        applySortingAndRender();
      } catch (e) {
        showError(e.message);
      } finally {
        loading = false;
        loadingIndicator.classList.add('hidden');
      }
    }

    async function fetchNetworkData(networkId, reset = false) {
      if (loading) return;
      if (reset) {
        data = [];
        swmtscards.innerHTML = '';
      }
      loading = true;
      loadingIndicator.classList.remove('hidden');
      try {
        const url = `${TMDB_BASE_URL}/discover/tv?api_key=${TMDB_API_KEY}&with_networks=${networkId}&page=${currentPage}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('Failed to load network data');
        const json = await res.json();
        const mapped = json.results
          .filter(i => i.poster_path)
          .map(i => ({
            id: i.id,
            title: i.name,
            desc: i.overview || 'N/A',
            img: `https://image.tmdb.org/t/p/w500${i.poster_path}`,
            date: i.first_air_date,
            type: 'tv',
            popularity: i.popularity
          }));
        const keys = new Set(data.map(d => `${d.id}-${d.type}`));
        const unique = mapped.filter(i => !keys.has(`${i.id}-${i.type}`));
        data = [...data, ...unique];
        applySortingAndRender(unique);
      } catch (e) {
        showError(e.message);
      } finally {
        loading = false;
        loadingIndicator.classList.add('hidden');
      }
    }

    async function fetchTrending(timeWindow, reset = false) {
      if (loading) return;
      if (reset) {
        data = [];
        swmtscards.innerHTML = '';
      }
      loading = true;
      loadingIndicator.classList.remove('hidden');
      try {
        let url;
        if (timeWindow === 'day' || timeWindow === 'week') {
          url = `${TMDB_BASE_URL}/trending/all/${timeWindow}?api_key=${TMDB_API_KEY}&page=${currentPage}`;
        } else if (timeWindow === 'year') {
          const yearAgo = new Date();
          yearAgo.setFullYear(yearAgo.getFullYear() - 1);
          const y = yearAgo.getFullYear();
          const m = String(yearAgo.getMonth() + 1).padStart(2, '0');
          const d = String(yearAgo.getDate()).padStart(2, '0');
          const dateStr = `${y}-${m}-${d}`;
          url = `${TMDB_BASE_URL}/discover/movie?api_key=${TMDB_API_KEY}&primary_release_date.gte=${dateStr}&sort_by=popularity.desc&page=${currentPage}`;
        }
        const res = await fetch(url);
        if (!res.ok) throw new Error('Failed to load trending');
        const json = await res.json();
        const results = json.results
          .filter(i => i.poster_path)
          .map(i => ({
            id: i.id,
            title: i.title || i.name,
            desc: i.overview || 'N/A',
            img: `https://image.tmdb.org/t/p/w500${i.poster_path}`,
            date: i.release_date || i.first_air_date,
            type: i.title ? 'movie' : 'tv',
            popularity: i.popularity
          }));
        const keys = new Set(data.map(d => `${d.id}-${d.type}`));
        const unique = results.filter(i => !keys.has(`${i.id}-${i.type}`));
        data = [...data, ...unique];
        applySortingAndRender(unique);
      } catch (e) {
        showError(e.message);
      } finally {
        loading = false;
        loadingIndicator.classList.add('hidden');
      }
    }

    async function fetchSearchData(query) {
      if (loading) return;
      loading = true;
      loadingIndicator.classList.remove('hidden');
      swmtscards.innerHTML = '';
      try {
        const url = `${TMDB_BASE_URL}/search/multi?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}&include_adult=false`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('Search failed');
        const json = await res.json();
        data = json.results
          .filter(i => (i.media_type === 'movie' || i.media_type === 'tv') && i.poster_path)
          .map(i => ({
            id: i.id,
            title: i.title || i.name,
            desc: i.overview || 'N/A',
            img: `https://image.tmdb.org/t/p/w500${i.poster_path}`,
            date: i.release_date || i.first_air_date,
            type: i.media_type,
            popularity: i.popularity
          }));
        if (data.length === 0) {
          swmtscards.innerHTML = `<p class="no-results text-center">No results for "${query}".</p>`;
        } else {
          applySortingAndRender();
        }
      } catch (e) {
        showError(e.message);
        swmtscards.innerHTML = '<p class="no-results text-center" style="color:#d9534f;">Search fail.</p>';
      } finally {
        loading = false;
        loadingIndicator.classList.add('hidden');
      }
    }

    window.addEventListener('scroll', () => {
      if ((activeMode === 'popular' || activeMode === 'network' || activeMode === 'trending') && !loading && !currentQuery) {
        const scrollableHeight = document.documentElement.scrollHeight - window.innerHeight;
        if (window.scrollY >= scrollableHeight - 900) {
          currentPage++;
          if (activeMode === 'popular') {
            fetchData();
          } else if (activeMode === 'network') {
            fetchNetworkData(activeParam, false);
          } else if (activeMode === 'trending') {
            fetchTrending(activeParam, false);
          }
        }
      }
    });

    function applySortingAndRender(itemsToAppend = null) {
      let dataToRender;
      if (!itemsToAppend) {
        swmtscards.innerHTML = '';
        const sorted = [...data];
        if (sortMethod === 'asc') {
          sorted.sort((a, b) => (a.title || '').localeCompare(b.title || ''));
        } else if (sortMethod === 'desc') {
          sorted.sort((a, b) => (b.title || '').localeCompare(a.title || ''));
        } else {
          sorted.sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
        }
        dataToRender = sorted;
      } else {
        dataToRender = itemsToAppend;
      }
      renderCards(dataToRender);
    }

    function renderCards(items) {
      const frag = document.createDocumentFragment();
      items.forEach((item, index) => {
        if (!item || !item.id || !item.title) return;
        const card = document.createElement('div');
        card.classList.add('custom-card');
        card.dataset.id = item.id;
        card.dataset.type = item.type;
        card.style.animationDelay = `${index * 0.1}s`;
        
        const watchedList = getWatchedList();
        const isWatched = watchedList.some(w => w.id === item.id && w.type === item.type);
        const watchedIcon = isWatched ? 'bi bi-check-circle-fill' : 'bi bi-plus-circle';
        const watchedLabel = isWatched ? 'Watched' : 'Add Watchlist';
        const watchedClass = isWatched ? 'is-watched' : '';
        
        // Enhanced card with micro-interactions
        card.innerHTML = `
          <div class="card-image-container">
            <img src="${item.img}" alt="${item.title}" loading="lazy" />
            <div class="card-overlay"></div>
          </div>
          <div class="card-content">
            <h3>${item.title}</h3>
            <div class="card-meta">
              <span class="badge">${item.date ? new Date(item.date).getFullYear() : 'N/A'}</span>
              <span class="badge">${item.type === 'movie' ? '🎬 Movie' : '📺 TV'}</span>
            </div>
            <p class="card-desc">${item.desc}</p>
            <div class="card-actions">
              <button class="btn btn-watch glow" onclick="navigateToWatchPage('${item.type}', ${item.id})">
                <i class="bi bi-play-fill"></i> Watch Now
              </button>
              <button class="btn btn-watched-toggle ${watchedClass}" onclick="${isWatched ? `removeFromWatchedList(${item.id}, '${item.type}', this)` : `addToWatchedList(${item.id}, '${item.type}', this)`}">
                <i class="${watchedIcon}"></i> <span>${watchedLabel}</span>
              </button>
            </div>
          </div>`;
        
        // Add hover effects and micro-interactions
        card.addEventListener('mouseenter', () => {
          card.style.transform = 'translateY(-10px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', () => {
          card.style.transform = 'translateY(0) scale(1)';
        });
        
        // Observe card for intersection animations
        cardObserver.observe(card);
        
        frag.appendChild(card);
      });
      swmtscards.appendChild(frag);
    }

    function navigateToWatchPage(type, id) {
      if (!type || !id) return;
      const hash = `#${type}-${id}`;
      window.location.href = `watch/${hash}`;
    }

    function updateWatchedButton(btn, isWatched) {
      if (!btn) return;
      const icon = btn.querySelector('i');
      const label = btn.querySelector('span');
      const card = btn.closest('.custom-card');
      if (!card) return;
      const id = parseInt(card.dataset.id);
      const type = card.dataset.type;
      if (isWatched) {
        icon.className = 'bi bi-check-circle-fill';
        label.textContent = 'Watched';
        btn.classList.add('is-watched');
        btn.onclick = () => removeFromWatchedList(id, type, btn);
      } else {
        icon.className = 'bi bi-plus-circle';
        label.textContent = 'Add Watchlist';
        btn.classList.remove('is-watched');
        btn.onclick = () => addToWatchedList(id, type, btn);
      }
    }

    function addToWatchedList(id, type, btn) {
      if (!id || !type) return;
      const list = getWatchedList();
      if (!list.some(i => i.id === id && i.type === type)) {
        list.push({ id, type, added: Date.now() });
        setWatchedList(list);
        updateWatchedButton(btn, true);
      }
    }

    function removeFromWatchedList(id, type, btn) {
      if (!id || !type) return;
      let list = getWatchedList();
      list = list.filter(i => !(i.id === id && i.type === type));
      setWatchedList(list);
      if (activeMode === 'watched') {
        const card = swmtscards.querySelector(`.custom-card[data-id='${id}'][data-type='${type}']`);
        if (card) {
          card.classList.add('fade-out');
          setTimeout(() => card.remove(), 500);
        }
        if (list.length === 0) {
          swmtscards.innerHTML = '<p class="no-results text-center">Watched list empty.</p>';
        }
      } else {
        updateWatchedButton(btn, false);
      }
    }

    let searchDebounceTimeout;
    searchInput.addEventListener('input', e => {
      const query = e.target.value.trim();
      clearTimeout(searchDebounceTimeout);
      if (query) {
        currentQuery = query;
        searchDebounceTimeout = setTimeout(() => {
          fetchSearchData(query);
        }, 350);
      } else {
        const activeBtn = document.getElementById(activeMode + '-tab') || document.getElementById('trending-tab');
        if (activeBtn) activeBtn.click();
      }
    });

    sortSelect.addEventListener('change', e => {
      sortMethod = e.target.value;
      if (currentQuery) {
        fetchSearchData(currentQuery);
      } else if (activeMode === 'popular') {
        fetchData(true);
      } else if (activeMode === 'watched') {
        applySortingAndRender();
      } else if (activeMode === 'network') {
        applySortingAndRender();
      } else if (activeMode === 'trending') {
        applySortingAndRender();
      }
    });

    trendingSelect.addEventListener('change', () => {
      const val = trendingSelect.value;
      activeParam = val;
      currentPage = 1;
      fetchTrending(val, true);
    });

    networkSelect.addEventListener('change', () => {
      const val = networkSelect.value;
      activeParam = val;
      currentPage = 1;
      fetchNetworkData(val, true);
    });

    document.addEventListener('visibilitychange', () => {
      // no dynamic background update
    });

    // Enhanced page initialization
    deduplicateWatchedList();
    
    // Add loading screen fade out
    window.addEventListener('load', () => {
      document.body.classList.add('loaded');
      
      // Initialize default tab with animation
      setTimeout(() => {
        document.getElementById('trending-tab').click();
      }, 500);
      
      // Add dynamic background updates
      setInterval(updateDynamicBackground, 30000); // Update every 30 seconds
    });
    
    // Dynamic background function
    function updateDynamicBackground() {
      const colors = [
        ['#6366f1', '#06b6d4'],
        ['#ec4899', '#f59e0b'], 
        ['#10b981', '#6366f1'],
        ['#8b5cf6', '#ec4899']
      ];
      
      const randomColors = colors[Math.floor(Math.random() * colors.length)];
      document.documentElement.style.setProperty('--gradient-primary', `linear-gradient(135deg, ${randomColors[0]}, ${randomColors[1]})`);
    }
    
    // Add keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        searchInput.blur();
      }
      if (e.ctrlKey && e.key === 'k') {
        e.preventDefault();
        searchInput.focus();
      }
    });
    
    // Enhanced search with debounce and suggestions
    let searchTimeout;
    searchInput.addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const query = e.target.value.trim();
        if (query.length > 2) {
          showSearchSuggestions(query);
        } else {
          hideSearchSuggestions();
        }
      }, 300);
    });
    
    function showSearchSuggestions(query) {
      // This would integrate with a search suggestions API
      // For now, just show the search is active
      document.querySelector('.search-wrapper').classList.add('searching');
    }
    
    function hideSearchSuggestions() {
      document.querySelector('.search-wrapper').classList.remove('searching');
    }
  </script>
</body>
</html>
